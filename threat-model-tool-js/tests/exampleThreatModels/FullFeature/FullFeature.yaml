ID: FullFeature
schemaVersion: 2
title: Comprehensive Reference TM
version: '1.0'
appliesToVersions: '>=5.1'
children:
  - REFID: SubComponent
  - REFID: ApiGateway
authors: |
  Jane Doe
  John Smith

history: |
  - 1.0  2024-01-01: Initial version
  - 1.1  2024-02-11: Added compliance and versioning features
  - 1.2  2026-02-13: Enhanced with real-world patterns for comprehensive testing

ISO27001Ref:
  ID: A.12.1.1
  description: Documented operating procedures
  group: Operations Security

gantt:
  startDate: '2024-01-01'
  endDate: '2024-03-01'
  status: In Progress

scope:
  description: |
    Full scope description for the comprehensive model.
    This example tests all features including cross-references, operational countermeasures,
    varied CVSS scores, and complex asset properties.
  securityObjectives:
    - ID: OBJ_CONFIDENTIALITY
      title: Data Confidentiality
      description: Protect data from unauthorized access.
      group: General
      treeImage: true
      inScope: true
    - ID: OBJ_INTEGRITY
      title: Data Integrity
      description: Protect data from unauthorized modification.
      group: General
      contributesTo:
        - REFID: OBJ_CONFIDENTIALITY
    - ID: OBJ_AVAILABILITY
      title: Service Availability
      description: Ensure service remains available to authorized users.
      group: General
      inScope: true

  assets:
    - ID: ASSET_USER_DATA
      title: User Data
      description: Personal data stored in the database.
      type: data
      inScope: true
      appliesToVersions: '>=5.0'
      properties:
        type: PII
        storage: Encrypted DB
        authentication: OAuth2
        authorization: RBAC
        TLS: '1.3'

    # Key/credential assets for Keys Summary testing
    - ID: API_KEY
      title: API Service Key
      description: Key used for authenticating API requests between services.
      type: key
      inScope: true
      applicationRelated: true
      properties:
        type: Ed25519
        length: '256 bits'
        Key Usage: Service-to-service authentication

    - ID: DB_CREDENTIAL
      title: Database Credential
      description: Credentials for database access.
      type: credential
      inScope: true
      properties:
        rotation: 90 days
        storage: Vault

    - ID: TLS_CERTIFICATE
      title: TLS Certificate
      description: Server TLS certificate for HTTPS.
      type: certificate
      inScope: true
      infrastructureRelated: true
      properties:
        algorithm: RSA-2048
        issuer: Internal CA
        validity: 1 year

    # Asset with array-style properties (tests Python .items() bug)
    - ID: ASSET_COMPLEX_PROPS
      title: Complex Properties Asset
      description: Asset with array-style properties to test rendering edge cases.
      type: service
      inScope: true
      properties:
        - name: protocol
          value: gRPC
        - name: port
          value: '443'
        - name: encryption
          value: TLS 1.3

    # Dataflow with inScope: false (tests Python inScope bug)
    - ID: DATAFLOW_EXTERNAL_API
      title: External API Communication
      description: |
        Communication with third-party external API.
        This is out of scope for this threat model.
      type: dataflow
      inScope: false

    - ID: DATAFLOW_INTERNAL
      title: Internal Service Communication
      description: Communication between internal microservices.
      type: dataflow
      inScope: true

  attackers:
    - ID: ATT_EXTERNAL
      title: External Attacker
      description: An attacker from the public internet.
      inScope: true
    - ID: ATT_INSIDER
      title: Malicious Insider
      description: An employee with legitimate access abusing privileges.
      inScope: true

  assumptions:
    - ID: ASSUMPTION_NETWORK
      description: Cloud network provides basic isolation.
    - ID: ASSUMPTION_ENCRYPTION
      description: Data at rest is encrypted using AES-256.

threat analysis: |
  ### Analysis Methodology
  Standard STRIDE analysis was performed covering:
  - Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege
  
  ### Threat Scoring
  CVSS 3.1 is used for consistent threat scoring across all identified threats.

threats:
  # HIGH severity threat - fully mitigated, should be green
  - ID: THREAT_SQL_INJECTION
    title: SQL Injection
    attack: |
      1. Find vulnerable input field.
      2. Inject SQL payload.
    threatType: Tampering
    impactDesc: High
    impactedSecObj:
      - REFID: OBJ_INTEGRITY
    attackers:
      - REFID: ATT_EXTERNAL
    assets:
      - REFID: ASSET_USER_DATA
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
      base: 9.8
    appliesToVersions: '>=5.1'
    compliance:
      GDPR:
        ref: Article 32
      ISO27001:
        ref: A.12.6.1
    fullyMitigated: true
    public: true
    countermeasures:
      - ID: CM_PREPARED_STATEMENTS
        title: Use Prepared Statements
        description: Ensure all DB queries use parameterized inputs.
        inPlace: true
        operational: false
        tested: true
        testRef: test-001
        ticketLink: https://jira.example.com/browse/DEV-456
        appliesToVersions: '>=5.1'
        public: true

  # MEDIUM severity threat - NOT fully mitigated, should be red
  - ID: THREAT_DATA_LEAK
    title: Potential Data Leak
    attack: Data might leak through logs or error messages.
    threatType: Information Disclosure
    impactedSecObj:
      - REFID: OBJ_CONFIDENTIALITY
    attackers:
      - REFID: ATT_INSIDER
    assets:
      - REFID: ASSET_USER_DATA
    CVSS:
      base: 6.5
      vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    fullyMitigated: false
    public: true
    countermeasures:
      - ID: CM_LOG_MASKING
        title: Log Masking
        description: Mask PII in logs.
        inPlace: false
        public: true

  # HIGH severity threat - mitigated with OPERATIONAL countermeasure, should be yellow
  - ID: THREAT_KEY_COMPROMISE
    title: API Key Compromise
    attack: |
      Attacker obtains API key through:
      1. Source code repository exposure
      2. Man-in-the-middle attack
      3. Social engineering
    threatType: Spoofing
    impactDesc: Complete service impersonation
    impactedSecObj:
      - REFID: OBJ_CONFIDENTIALITY
      - REFID: OBJ_INTEGRITY
    attackers:
      - REFID: ATT_EXTERNAL
    assets:
      - REFID: API_KEY
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:N
      base: 10.0
    fullyMitigated: true
    public: true
    countermeasures:
      # Operational countermeasure - tests operator field and yellow status
      - ID: CM_KEY_ROTATION
        title: Regular Key Rotation
        description: |
          Rotate API keys every 30 days or immediately upon suspected compromise.
          Keys should be stored in a secure vault with audit logging.
        inPlace: true
        operational: true
        operator: Security Operations Team
        public: true
      - ID: CM_KEY_VAULT
        title: Secure Key Storage
        description: Store keys in HashiCorp Vault with audit logging.
        inPlace: true
        operational: true
        operator: Platform Team
        public: true

  # CRITICAL severity threat - tests CVSS sorting (should appear first in high severity list)
  - ID: THREAT_RCE
    title: Remote Code Execution
    attack: |
      Exploiting deserialization vulnerability to execute arbitrary code.
    threatType: Elevation of Privilege
    impactDesc: Full system compromise
    impactedSecObj:
      - REFID: OBJ_CONFIDENTIALITY
      - REFID: OBJ_INTEGRITY
      - REFID: OBJ_AVAILABILITY
    attackers:
      - REFID: ATT_EXTERNAL
    assets:
      - REFID: ASSET_USER_DATA
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
      base: 10.0
    fullyMitigated: false
    public: true
    countermeasures:
      - ID: CM_INPUT_VALIDATION
        title: Strict Input Validation
        description: Validate and sanitize all deserialized input.
        inPlace: false
        public: true
        operational: false

  # LOW severity threat - tests varying CVSS scores in sorting
  - ID: THREAT_INFO_DISCLOSURE
    title: Minor Information Disclosure
    attack: Version information exposed in HTTP headers.
    threatType: Information Disclosure
    impactDesc: Low - only exposes version info
    impactedSecObj:
      - REFID: OBJ_CONFIDENTIALITY
    attackers:
      - REFID: ATT_EXTERNAL
    CVSS:
      vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
      base: 5.3
    fullyMitigated: true
    public: true
    countermeasures:
      - ID: CM_HEADER_REMOVAL
        title: Remove Version Headers
        description: Configure server to not expose version information.
        inPlace: true
        operational: true
        operator: DevOps Team
        public: true
